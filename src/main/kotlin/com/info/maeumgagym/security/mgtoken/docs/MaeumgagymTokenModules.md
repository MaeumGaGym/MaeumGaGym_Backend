# MaeumgagymTokenModules
인증용 토큰을 관리하기 위한 네 개의 클래스입니다.

---

### 왜 토큰을 사용하나요?
이전(~2024.04)에는 토큰을 발급할 때, 서버에서도 저장하여 일치하는 토큰이 존재하는지 확인하는 식으로 인증 로직이 작성되어 있었습니다.

세션 기반 인증 방식과 별 다를 바 없지만, 토큰의 생성 로직도 존재하고 있었기에 비용 낭비가 심했습니다.

이런 비용 낭비를 제거하고자, 세션과 토큰 중 고민 끝에 서버의 부담이 덜한 토큰을 사용하기로 결정했습니다.

---
### 클래스는 어떻게 설계되어 있나요?
1. 사용자 정보를 토큰으로 암호화하는 [MaeumgagymTokenEncoder],
2. 발급된 토큰을 복호화해 VO로 전환하는 [MaeumgagymTokenDecoder],
3. 복호화한 토큰을 검증하는 [MaeumgagymTokenValidator],
4. 토큰을 무효화하는 [MaeumgagymTokenRevoker]가 존재합니다.

---
### 왜 이렇게 설계했나요?
각각의 기능은 원래 비즈니스 로직에서 호출하는 토큰 관리자인 [JwtAdapter], 인증 로직에서 호출하는 토큰 처리자인 [JwtResolver]에 함수로 분산되어 있었습니다.

하지만 이 설계는 토큰 관리 기능들에 대해 재사용성이 심각하게 낮았고, [JwtAdapter] 안에서도 중복 코드가 존재했습니다.

이를 해결하고자 기능들을 분리해내어 위와 같이 모듈화했습니다.

---
### 왜 JWT 토큰을 사용하지 않나요?

먼저 JWT 토큰에 대해 짚고 넘어갈 필요가 있습니다.

Jwt 토큰은 Header, Payload, Signature의 세 부분으로 나뉩니다.

Header 및 Payload엔 토큰에 대한 정보를 담아 오로지 Base64로만 인코딩하고,

Signature에는 서버의 키(Key)의 해시를 담아 Base64로 인코딩해 토큰에 서명합니다.

토큰을 서버에서 검증할 때는 이 서명을 비교하여 토큰의 유효성을 판단합니다.

---

하지만 사용자 인증 정보가 담기는 Payload 부분이 Base64로만 인코딩되기 때문에, 토큰에 정보를 담아야하는 저희로썬 민감하게 볼 수밖에 없었습니다.

또한 저희가 사용하고 있었으며, JWT 토큰을 관리하기 위한 가장 보편적인 라이브러리인 "jjwt"에서 제공하는 클래스들은 저희가 사용하기에는 다소 부적합한 점이 많았습니다. 가장 큰 이유는 책임 분할의 어려움이었습니다.

결국 jjwt 라이브러리를 사용하지 않기로 했으나, 나머지 라이브러리들은 신뢰성이 낮거나 까다로웠습니다.

더불어, 앞서 언급한 JWT 토큰의 문제점들을 감수하고 JWT 토큰을 사용할만큼 좋은 점도 보이지 않았습니다.

JWT 토큰을 저희가 구현하는 것 역시나 여러 문제점으로 인해 별로 매력적으로 보이지 않았습니니다.

그렇기에 저희는 JWT 토큰을 개선한, 마음가짐만만을 위한 커스텀 토큰을 만들었습니다.

### 마음가짐 토큰이 무엇인가요?
JWT 토큰을 개선하고자 새로이 만들어낸 토큰입니다.

사용자의 인증 정보를 JSON 데이터를 담아, 양방향 암호화 대칭키 알고리즘인 AES를 통해 암호화합니다.

사용되는 정보는 아래와 같습니다.
- 사용자 ID : 토큰의 발급 대상을 식별하기 위함입니다.
- 발급 받은 클라이언트의 IP 주소 : 토큰이 탈취되었는지를 확인하기 위함입니다.
- 발급 시간
- 만료 시간
- 토큰 타입 : Access Token인지, Refresh Token인지를 판별하기 위함입니다.
- 토큰 ID : 토큰을 무효화할 때 사용하는 UUID의 문자열 ID입니다.
